{% extends "base.html" %}
{% block title %}ë§í¬ìš”ì²­ - MONEYING{% endblock %}

{% block main_class %}max-w-7xl mx-auto px-4 pt-20 md:pt-24{% endblock %}
{% block head_extra %}
<style>
.btn-glow { position: relative; overflow: hidden; transition: all 0.3s ease; }
.btn-glow::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s ease; }
.btn-glow:hover::before { left: 100%; }
.btn-glow:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(196, 255, 0, 0.4); }
</style>
{% endblock %}
{% block content %}

<!-- íˆì–´ë¡œ ì„¹ì…˜ -->
<section class="text-center pt-10 pb-16 md:pt-16 md:pb-20">
  <h1 class="text-3xl md:text-5xl font-black mb-4 leading-snug md:leading-normal">
  ì¿ íŒ¡ì— ì—†ëŠ” ìƒí’ˆë„<br>
  <span class="text-[#c4ff00]">ìˆ˜ìµí™”</span>í•˜ì„¸ìš”
</h1>
<p class="text-zinc-400 mt-2 text-sm md:text-base leading-relaxed max-w-xl mx-auto mb-8">
  ì—…ì²´ ê³„ì•½ ì—†ì´ë„ ì¿ íŒ¡ ë§í¬ë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ìš”.<br>
  ì˜¤í”ˆë°© ì…ì¥ í›„ ì›ë³¸ ë§í¬ë§Œ ë‚¨ê²¨ì£¼ì‹œë©´, ì €í¬ê°€ ë“±ë¡í•´ë“œë¦½ë‹ˆë‹¤.
</p>
  
  <div class="flex justify-center gap-3">
    <button onclick="checkLinkRequestAccess()"
   class="btn-glow bg-[#c4ff00] text-black font-black px-8 py-4 rounded-md transition text-lg">
      ë§í¬ìš”ì²­ í•˜ê¸° â†’
    </button>
    <a href="https://open.kakao.com/o/gYyHLsoh" target="_blank"
       class="bg-[#FEE500] text-[#3C1E1E] font-black px-6 py-4 rounded-md hover:bg-[#FDD800] transition flex items-center gap-2 text-lg">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3C6.48 3 2 6.58 2 11c0 2.83 1.89 5.29 4.68 6.68-.15.53-.53 1.94-.61 2.24-.1.37.14.37.29.27.12-.08 1.87-1.23 2.63-1.73.65.09 1.32.14 2.01.14 5.52 0 10-3.58 10-8s-4.48-8-10-8z"/></svg>
      ì˜¤í”ˆë°© ì…ì¥
    </a>
  </div>
  
  <!-- ì´ìš© íšŸìˆ˜ ì•ˆë‚´ (ì‘ê²Œ) -->
  <div class="flex justify-center gap-4 mt-8 text-sm text-zinc-500">
    <span>ì²´í—˜ì¤‘ <strong class="text-zinc-300"> 1íšŒ</strong></span>
    <span class="text-zinc-700">|</span>
    <span>ê°€ì…ì <strong class="text-zinc-300">ì›” 3íšŒ</strong></span>
    <span class="text-zinc-700">|</span>
    <span>êµ¬ë…ì <strong class="text-zinc-300">ì›” 10íšŒ</strong></span>
    <span class="text-zinc-700">|</span>
    <span>ì˜¬ì¸ì› <strong class="text-[#c4ff00]">ì›” 20íšŒ</strong></span>
  </div>
  
  <!-- ë¹„êµ¬ë…ì ì•ˆë‚´ -->
  <div class="mt-6 text-center">
    <p class="text-zinc-400 text-sm">ë¹„êµ¬ë…ìëŠ” <a href="https://open.kakao.com/o/gYyHLsoh" target="_blank" class="text-[#FEE500] font-bold hover:underline">ì˜¤í”ˆì±„íŒ…ë°©</a> ì…ì¥ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
  </div>
</section>

<!-- ì´ëŸ° ë¶„ë“¤ì„ ìœ„í•œ ì„œë¹„ìŠ¤ -->
<section class="py-16 border-t border-zinc-800">
  <h2 class="text-3xl md:text-5xl font-black text-center mb-4 leading-snug md:leading-normal">ì´ëŸ° ê³ ë¯¼ ìˆìœ¼ì…¨ë‚˜ìš”?</h2>
  <p class="text-base md:text-xl text-white/60 text-center mb-12">ë§í¬ìš”ì²­ ì„œë¹„ìŠ¤ë¡œ í•´ê²°í•˜ì„¸ìš”</p>
  
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-8 text-center hover:border-zinc-700 transition">
      <div class="w-16 h-16 bg-blue-500/10 rounded-2xl flex items-center justify-center mx-auto mb-5">
        <span class="text-3xl">ğŸŒ</span>
      </div>
      <h3 class="font-bold text-lg mb-2">í•´ì™¸ ì˜ìƒ ì°¾ì•˜ëŠ”ë°...</h3>
      <p class="text-zinc-500 text-sm">ì¢‹ì€ ì˜ìƒ ë°œêµ´í–ˆëŠ”ë°<br>ì¿ íŒ¡ì— ìƒí’ˆì´ ì—†ì–´ìš”</p>
    </div>
    
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-8 text-center hover:border-zinc-700 transition">
      <div class="w-16 h-16 bg-purple-500/10 rounded-2xl flex items-center justify-center mx-auto mb-5">
        <span class="text-3xl">ğŸ¤</span>
      </div>
      <h3 class="font-bold text-lg mb-2">ì—…ì²´ ê³„ì•½ì´ ì–´ë ¤ì›Œìš”</h3>
      <p class="text-zinc-500 text-sm">íŒ”ë¡œì›Œê°€ ì ì–´ì„œ<br>ì§ì ‘ ê³„ì•½ì´ ì•ˆ ë¼ìš”</p>
    </div>
    
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-8 text-center hover:border-zinc-700 transition">
      <div class="w-16 h-16 bg-green-500/10 rounded-2xl flex items-center justify-center mx-auto mb-5">
        <span class="text-3xl">â°</span>
      </div>
      <h3 class="font-bold text-lg mb-2">ë“±ë¡í•  ì‹œê°„ì´ ì—†ì–´ìš”</h3>
      <p class="text-zinc-500 text-sm">ì˜ìƒ ë§Œë“¤ê¸°ë„ ë°”ìœë°<br>ìƒí’ˆ ë“±ë¡ê¹Œì§€ í•´ì•¼ í•´ìš”</p>
    </div>
  </div>
</section>

<!-- ì´ìš© ë°©ë²• -->
<section id="how-it-works" class="py-16 border-t border-zinc-800">
  <h2 class="text-3xl md:text-5xl font-black text-center mb-4 leading-snug md:leading-normal">ê°„ë‹¨í•œ ì´ìš© ë°©ë²•</h2>
  <p class="text-base md:text-xl text-white/60 text-center mb-12">3ë‹¨ê³„ë©´ ë!</p>
  
  <div class="max-w-3xl mx-auto">
    <div class="flex flex-col md:flex-row items-center gap-6 md:gap-4">
      
      <!-- Step 1 -->
      <div class="flex-1 text-center">
        <div class="w-12 h-12 bg-[#c4ff00] text-black font-black text-xl rounded-full flex items-center justify-center mx-auto mb-4">1</div>
        <h3 class="font-bold mb-2">ë§í¬ ìš”ì²­</h3>
        <p class="text-zinc-500 text-sm">ì›ë³¸ ë§í¬ë¥¼<br>ë‚¨ê²¨ì£¼ì„¸ìš”</p>
      </div>
      
      <!-- Arrow -->
      <div class="hidden md:block text-zinc-600 text-2xl">â†’</div>
      <div class="md:hidden text-zinc-600 text-2xl rotate-90">â†’</div>
      
      <!-- Step 2 -->
      <div class="flex-1 text-center">
        <div class="w-12 h-12 bg-[#c4ff00] text-black font-black text-xl rounded-full flex items-center justify-center mx-auto mb-4">2</div>
        <h3 class="font-bold mb-2">ìƒí’ˆ ë“±ë¡</h3>
        <p class="text-zinc-500 text-sm">ì €í¬ê°€ ì¿ íŒ¡ì—<br>ë“±ë¡í•´ë“œë ¤ìš”</p>
        <p class="text-zinc-600 text-xs mt-1">(1~3ì¼ ì†Œìš”)</p>
      </div>
      
      <!-- Arrow -->
      <div class="hidden md:block text-zinc-600 text-2xl">â†’</div>
      <div class="md:hidden text-zinc-600 text-2xl rotate-90">â†’</div>
      
      <!-- Step 3 -->
      <div class="flex-1 text-center">
        <div class="w-12 h-12 bg-[#c4ff00] text-black font-black text-xl rounded-full flex items-center justify-center mx-auto mb-4">3</div>
        <h3 class="font-bold mb-2">ë§í¬ ì „ë‹¬</h3>
        <p class="text-zinc-500 text-sm">ì¿ íŒ¡ ë§í¬ë¥¼<br>ë°›ì•„ê°€ì„¸ìš”</p>
      </div>
      
    </div>
  </div>
</section>

<!-- ë‚´ ìš”ì²­ ëª©ë¡ -->
<section class="py-16 border-t border-zinc-800">
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div>
      <h2 class="text-2xl font-black">ë‚´ ìš”ì²­ ëª©ë¡</h2>
      <p class="text-zinc-500 text-sm mt-1">ìš”ì²­í•˜ì‹  ë§í¬ì˜ ì²˜ë¦¬ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</p>
    </div>
    
    <!-- ì´ë²ˆ ë‹¬ ì‚¬ìš©ëŸ‰ + ìƒˆ ìš”ì²­ ë²„íŠ¼ -->
    <div class="flex items-center gap-4">
      {% if session.get("user_id") and not session.get("admin") %}
        <div class="bg-zinc-900 border border-zinc-800 rounded-xl px-4 py-2">
          <div class="flex items-center gap-3">
            <span class="text-zinc-500 text-sm">ì´ë²ˆ ë‹¬</span>
            <span class="font-black 
              {% if (monthly_used or 0) >= (monthly_limit or 3) %}text-red-400{% else %}text-white{% endif %}">
              {{ monthly_used or 0 }}/{{ monthly_limit or 3 }}íšŒ
            </span>
            {% if (monthly_used or 0) >= (monthly_limit or 3) %}
              <span class="text-xs text-red-400">í•œë„ ì´ˆê³¼</span>
            {% endif %}
          </div>
        </div>
      {% endif %}
      
      <button onclick="checkLinkRequestAccess()"
         class="bg-[#c4ff00] text-black font-black px-5 py-2 rounded-lg hover:bg-white transition">
        + ìƒˆ ìš”ì²­
      </button>
    </div>
  </div>
  
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
    {% if not session.get("user_id") %}
      <div class="p-10 text-center">
        <div class="text-4xl mb-4">ğŸ”’</div>
        <div class="text-zinc-500 font-bold mb-2">ë¡œê·¸ì¸í•˜ë©´ ìš”ì²­ ëª©ë¡ì„ ë³¼ ìˆ˜ ìˆì–´ìš”</div>
        <p class="text-zinc-600 text-sm">ë‚´ ìš”ì²­ í˜„í™©ì„ í™•ì¸í•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”</p>
      </div>
    {% elif items|length == 0 %}
      <div class="p-10 text-center">
        <div class="text-4xl mb-4">ğŸ“­</div>
        <div class="text-zinc-500 font-bold mb-2">ì•„ì§ ìš”ì²­í•œ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>
        <p class="text-zinc-600 text-sm">ì²« ë²ˆì§¸ ë§í¬ë¥¼ ìš”ì²­í•´ë³´ì„¸ìš”!</p>
      </div>
    {% else %}
      <div class="divide-y divide-zinc-800/70">
        {% for it in items %}
          <a href="/link-requests/{{ it.id }}" class="block px-6 py-5 hover:bg-zinc-800/50 transition">
            <div class="flex items-center justify-between gap-4">
              <div class="min-w-0 flex-1">
                <div class="font-bold truncate mb-1">{{ it.title }}</div>
                <div class="text-zinc-500 text-sm truncate">{{ it.original_url[:50] }}...</div>
              </div>
              <div class="shrink-0 flex items-center gap-4">
                <span class="text-zinc-600 text-xs hidden sm:block">{{ (it.created_at|string)[:10] }}</span>
                {% if it.coupang_url %}
                  <span class="px-3 py-1 rounded-full bg-green-500/10 text-green-400 border border-green-500/20 text-xs font-bold">ì™„ë£Œ</span>
                {% else %}
                  <span class="px-3 py-1 rounded-full bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 text-xs font-bold">ëŒ€ê¸°ì¤‘</span>
                {% endif %}
              </div>
            </div>
          </a>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>

<!-- ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  function checkLinkRequestAccess() {
    const userStatus = {
      isLoggedIn: {{ 'true' if session.get('user_id') else 'false' }},
      isSubscriber: {{ 'true' if session.get('subscriber') else 'false' }},
      isTrial: {{ 'true' if session.get('is_trial') else 'false' }},
      isSeller: {{ 'true' if session.get('is_seller') else 'false' }},
      isAdmin: {{ 'true' if session.get('admin') else 'false' }},
      monthlyUsed: {{ monthly_used or 0 }},
      monthlyLimit: {{ monthly_limit or 3 }}
    };
    
    // ê´€ë¦¬ìëŠ” ë°”ë¡œ ì´ë™
    if (userStatus.isAdmin) {
      location.href = '/link-requests/new';
      return;
    }
    
    
    // íŒë§¤ìëŠ” ëª¨ë‹¬ í‘œì‹œ
    if (userStatus.isSeller) {
      showLinkRequestModal(userStatus);
      return;
    }
    // êµ¬ë…ì + í•œë„ ë‚´ë©´ ë°”ë¡œ ì´ë™ (ì²´í—˜ ì¤‘ì€ ì œì™¸)
    if (userStatus.isLoggedIn && userStatus.isSubscriber && !userStatus.isTrial) {
      if (userStatus.monthlyUsed < userStatus.monthlyLimit) {
        location.href = '/link-requests/new';
        return;
      }
    }
    
    // ëª¨ë‹¬ í‘œì‹œ
    showLinkRequestModal(userStatus);
  }

  function showLinkRequestModal(status) {
    let title, message, buttons;
    
    if (status.isSeller) {
      // íŒë§¤ì
      title = 'ğŸš« ì´ìš© ë¶ˆê°€';
      message = 'ë§í¬ìš”ì²­ì€ í¬ë¦¬ì—ì´í„° ì „ìš© ì„œë¹„ìŠ¤ì˜ˆìš”.<br>íŒë§¤ì ê³„ì •ì€ ì´ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
      buttons = '<button onclick="closeLinkModal()" class="w-full py-3 bg-zinc-700 text-white rounded-xl font-bold hover:bg-zinc-600 transition">í™•ì¸</button>';
    } else if (!status.isLoggedIn) {
      // ë¯¸ê°€ì…ì
      title = 'ğŸ”’ íšŒì› ì „ìš© ì„œë¹„ìŠ¤';
      message = 'ë§í¬ìš”ì²­ì„ ì´ìš©í•˜ë ¤ë©´<br>ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”!';
      buttons = `
        <div class="flex gap-3">
          <a href="/login" class="flex-1 py-3 bg-[#c4ff00] text-black rounded-xl font-bold text-center hover:bg-white transition">ë¡œê·¸ì¸</a>
          <a href="/signup" class="flex-1 py-3 border border-zinc-600 text-white rounded-xl font-bold text-center hover:bg-zinc-800 transition">íšŒì›ê°€ì…</a>
        </div>
      `;
    } else if (!status.isSubscriber || status.isTrial) {
      // ê°€ì…ì (ë¹„êµ¬ë…) ë˜ëŠ” ì²´í—˜ì¤‘
      title = 'ğŸ”— ë§í¬ìš”ì²­ ì´ìš© ì•ˆë‚´';
      message = '<strong class="text-white">êµ¬ë…ì</strong>ëŠ” ì›” 10~20íšŒ ì´ìš© ê°€ëŠ¥<br><strong class="text-white">ì˜¤í”ˆì±„íŒ… ë©¤ë²„</strong>ëŠ” ì›” 3íšŒ ë¬´ë£Œ!';
      buttons = `
        <div class="space-y-3">
          <a href="/pricing" class="w-full py-3 bg-[#c4ff00] text-black rounded-xl font-bold text-center hover:bg-white transition block">êµ¬ë…í•˜ê¸°</a>
          <div class="relative flex items-center gap-2 my-4">
            <div class="flex-1 h-px bg-zinc-700"></div>
            <span class="text-zinc-500 text-xs">ë˜ëŠ” ì˜¤í”ˆì±„íŒ… ë©¤ë²„ë¼ë©´</span>
            <div class="flex-1 h-px bg-zinc-700"></div>
          </div>
          <a href="https://open.kakao.com/o/gYyHLsoh" target="_blank" class="w-full py-3 bg-[#FEE500] text-[#3C1E1E] rounded-xl font-bold text-center hover:bg-yellow-300 transition flex items-center justify-center gap-2">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3C6.48 3 2 6.58 2 11c0 2.8 1.8 5.27 4.5 6.7-.2.74-.7 2.68-.8 3.1-.13.5.18.5.38.36.16-.1 2.46-1.66 3.46-2.33.48.07.97.1 1.46.1 5.52 0 10-3.58 10-8s-4.48-8-10-8z"/></svg>
            ì˜¤í”ˆì±„íŒ… ì…ì¥í•˜ê¸°
          </a>
          <div class="relative">
            <input type="text" id="accessCodeInput" placeholder="ê³µì§€ ì½”ë“œ ì…ë ¥" class="w-full py-3 px-4 bg-zinc-800 border border-zinc-700 rounded-xl text-white text-center font-bold uppercase tracking-wider focus:border-[#c4ff00] focus:outline-none">
          </div>
          <button onclick="verifyAccessCode()" class="w-full py-3 border border-zinc-600 text-white rounded-xl font-bold hover:bg-zinc-800 transition">ì½”ë“œ í™•ì¸</button>
        </div>
      `;
    } else if (status.monthlyUsed >= status.monthlyLimit) {
      // í•œë„ ì´ˆê³¼
      title = 'âš ï¸ ì´ë²ˆ ë‹¬ í•œë„ ì´ˆê³¼';
      message = `ì´ë²ˆ ë‹¬ ë§í¬ìš”ì²­ <strong>${status.monthlyLimit}íšŒ</strong>ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆì–´ìš”.<br>ë‹¤ìŒ ë‹¬ 1ì¼ì— ì´ˆê¸°í™”ë©ë‹ˆë‹¤.`;
      buttons = '<button onclick="closeLinkModal()" class="w-full py-3 bg-zinc-700 text-white rounded-xl font-bold hover:bg-zinc-600 transition">í™•ì¸</button>';
    }
    
    const modalHtml = `
      <div id="linkRequestModal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm" onclick="if(event.target === this) closeLinkModal()">
        <div class="bg-zinc-900 border border-zinc-700 rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl">
          <h3 class="text-xl font-bold text-white text-center mb-3">${title}</h3>
          <p class="text-zinc-400 text-center mb-6 leading-relaxed">${message}</p>
          ${buttons}
        </div>
      </div>
    `;
    
    closeLinkModal();
    document.body.insertAdjacentHTML('beforeend', modalHtml);
  }

  function closeLinkModal() {
    const modal = document.getElementById('linkRequestModal');
    if (modal) modal.remove();
  }

  function verifyAccessCode() {
    const code = document.getElementById('accessCodeInput').value.trim().toUpperCase();
    if (!code) {
      alert('ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }
    
    const validCode = 'MONEYING';  // ì„ì‹œ ì½”ë“œ
    
    if (code === validCode) {
      closeLinkModal();
      location.href = '/link-requests/new';
    } else {
      alert('ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì˜¤í”ˆì±„íŒ…ë°© ê³µì§€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!');
    }
  }
</script>

{% endblock %}
