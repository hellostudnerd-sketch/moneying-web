{% extends "admin_base.html" %}
{% block title %}íŒë§¤ì ê²Œì‹œë¬¼ ê´€ë¦¬ - MONEYING Admin{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-black">íŒë§¤ì ê²Œì‹œë¬¼ ê´€ë¦¬</h1>
      <p class="text-zinc-400 mt-2">íŒë§¤ìê°€ ì—…ë¡œë“œí•œ ì˜ìƒ ìŠ¹ì¸/ê±°ì ˆ</p>
    </div>
  </div>

  <!-- í•„í„° íƒ­ -->
  <div class="flex gap-2 mb-6">
    <a href="?status=pending" class="px-4 py-2 rounded-lg font-bold text-sm transition {% if status_filter == 'pending' %}bg-[#a3e635] text-black{% else %}bg-zinc-800 text-zinc-400 hover:bg-zinc-700{% endif %}">
      ëŒ€ê¸°ì¤‘
    </a>
    <a href="?status=approved" class="px-4 py-2 rounded-lg font-bold text-sm transition {% if status_filter == 'approved' %}bg-[#a3e635] text-black{% else %}bg-zinc-800 text-zinc-400 hover:bg-zinc-700{% endif %}">
      ìŠ¹ì¸ë¨
    </a>
    <a href="?status=rejected" class="px-4 py-2 rounded-lg font-bold text-sm transition {% if status_filter == 'rejected' %}bg-[#a3e635] text-black{% else %}bg-zinc-800 text-zinc-400 hover:bg-zinc-700{% endif %}">
      ê±°ì ˆë¨
    </a>
    <a href="?status=all" class="px-4 py-2 rounded-lg font-bold text-sm transition {% if status_filter == 'all' %}bg-[#a3e635] text-black{% else %}bg-zinc-800 text-zinc-400 hover:bg-zinc-700{% endif %}">
      ì „ì²´
    </a>
  </div>

  <!-- ëª©ë¡ -->
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
    {% if posts|length == 0 %}
      <div class="p-10 text-center">
        <div class="text-4xl mb-4">ğŸ“¹</div>
        <div class="text-zinc-500 font-bold">ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    {% else %}
      <table class="w-full">
        <thead class="bg-zinc-800/50">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì œëª©</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì¹´í…Œê³ ë¦¬</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì˜ìƒ ë§í¬</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ë“±ë¡ì¼</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ìƒíƒœ</th>
            <th class="px-6 py-4 text-right text-xs font-bold text-zinc-500 uppercase">ì•¡ì…˜</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-zinc-800/70">
          {% for post in posts %}
            <tr class="hover:bg-zinc-800/30 transition" id="post-row-{{ post.id }}">
              <td class="px-6 py-4">
                <div class="font-bold text-white">{{ post.title }}</div>
              </td>
              <td class="px-6 py-4 text-zinc-300">{{ post.category }}</td>
              <td class="px-6 py-4">
                {% if post.video_url %}
                  <a href="{{ post.video_url }}" target="_blank" class="text-blue-400 hover:underline text-sm">ë§í¬1</a>
                {% endif %}
                {% if post.video_url2 %}
                  <a href="{{ post.video_url2 }}" target="_blank" class="text-blue-400 hover:underline text-sm ml-2">ë§í¬2</a>
                {% endif %}
                {% if post.video_url3 %}
                  <a href="{{ post.video_url3 }}" target="_blank" class="text-blue-400 hover:underline text-sm ml-2">ë§í¬3</a>
                {% endif %}
              </td>
              <td class="px-6 py-4 text-zinc-500 text-sm">{{ post.created_at.strftime('%Y-%m-%d') }}</td>
              <td class="px-6 py-4">
                {% if post.status == 'approved' %}
                  <span class="px-3 py-1 rounded-full bg-green-500/10 text-green-400 border border-green-500/20 text-xs font-bold">ìŠ¹ì¸ë¨</span>
                {% elif post.status == 'pending' %}
                  <span class="px-3 py-1 rounded-full bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 text-xs font-bold">ëŒ€ê¸°ì¤‘</span>
                {% else %}
                  <span class="px-3 py-1 rounded-full bg-red-500/10 text-red-400 border border-red-500/20 text-xs font-bold">ê±°ì ˆë¨</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 text-right">
                {% if post.status == 'pending' %}
                  <button onclick="approvePost({{ post.id }})" class="px-3 py-1 bg-green-600 hover:bg-green-500 text-white rounded text-sm font-bold mr-2">ìŠ¹ì¸</button>
                  <button onclick="rejectPost({{ post.id }})" class="px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded text-sm font-bold">ê±°ì ˆ</button>
                {% elif post.status == 'approved' %}
                  <a href="/gallery/{{ post.id }}" target="_blank" class="text-[#a3e635] text-sm font-bold hover:underline">ë³´ê¸°</a>
                {% else %}
                  <button onclick="approvePost({{ post.id }})" class="px-3 py-1 bg-zinc-700 hover:bg-zinc-600 text-white rounded text-sm font-bold">ì¬ìŠ¹ì¸</button>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>

</div>

<script>
function approvePost(postId) {
  if (!confirm('ì´ ê²Œì‹œë¬¼ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  fetch(`/admin/seller-posts/${postId}/approve`, { method: 'POST' })
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        alert('ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        location.reload();
      } else {
        alert('ì˜¤ë¥˜: ' + (data.error || 'unknown'));
      }
    });
}

function rejectPost(postId) {
  if (!confirm('ì´ ê²Œì‹œë¬¼ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  fetch(`/admin/seller-posts/${postId}/reject`, { method: 'POST' })
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        alert('ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.');
        location.reload();
      } else {
        alert('ì˜¤ë¥˜: ' + (data.error || 'unknown'));
      }
    });
}
</script>
{% endblock %}