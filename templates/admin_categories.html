{% extends "admin_base.html" %}
{% block title %}ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ - MONEYING Admin{% endblock %}
{% block page_title %}ì¹´í…Œê³ ë¦¬ ê´€ë¦¬{% endblock %}
{% block page_desc %}ê°¤ëŸ¬ë¦¬ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€/ê´€ë¦¬í•©ë‹ˆë‹¤.{% endblock %}

{% block content_admin %}

<!-- ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ -->
<div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6 mb-8">
  <h2 class="font-bold text-lg mb-4">ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h2>
  <form method="POST" action="/admin/categories/add" class="flex flex-wrap gap-4 items-end">
    <div class="flex-1 min-w-[120px]">
      <label class="block text-sm font-bold text-zinc-400 mb-2">í‚¤ (ì˜ë¬¸)</label>
      <input type="text" name="key" required placeholder="ì˜ˆ: fashion"
             class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-white focus:border-[#a3e635] focus:outline-none">
    </div>
    <div class="flex-1 min-w-[120px]">
      <label class="block text-sm font-bold text-zinc-400 mb-2">ì´ë¦„</label>
      <input type="text" name="name" required placeholder="ì˜ˆ: Fashion"
             class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-white focus:border-[#a3e635] focus:outline-none">
    </div>
    <div class="w-24">
      <label class="block text-sm font-bold text-zinc-400 mb-2">ì´ëª¨ì§€</label>
      <input type="text" name="emoji" placeholder="ğŸ‘—"
             class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-white focus:border-[#a3e635] focus:outline-none text-center">
    </div>
    <button type="submit" class="px-6 py-3 bg-[#a3e635] text-black font-black rounded-xl hover:bg-white transition">
      + ì¶”ê°€
    </button>
  </form>
</div>

<!-- ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
<div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
  <div class="flex items-center justify-between px-5 py-4 border-b border-zinc-800">
    <div class="font-black">ì¹´í…Œê³ ë¦¬ ëª©ë¡</div>
    <div class="text-zinc-400 text-sm">{{ categories|length }}ê°œ</div>
  </div>
  
  <table class="w-full">
    <thead class="bg-zinc-800/50">
      <tr>
        <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ìˆœì„œ</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì¹´í…Œê³ ë¦¬</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">í‚¤</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">íƒ€ì…</th>
        <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ìƒíƒœ</th>
        <th class="px-6 py-4 text-right text-xs font-bold text-zinc-500 uppercase">ì•¡ì…˜</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-zinc-800/70">
      {% for cat in categories %}
        <tr class="hover:bg-zinc-800/30 transition">
          <td class="px-6 py-4 text-zinc-500">{{ cat.sort_order }}</td>
          <td class="px-6 py-4">
            <span class="text-xl mr-2">{{ cat.emoji }}</span>
            <span class="font-bold text-white">{{ cat.name }}</span>
          </td>
          <td class="px-6 py-4 text-zinc-400 font-mono text-sm">{{ cat.key }}</td>
          <td class="px-6 py-4">
            {% if cat.is_system %}
              <span class="px-2 py-1 rounded bg-blue-500/20 text-blue-400 text-xs font-bold">ì‹œìŠ¤í…œ</span>
            {% else %}
              <span class="px-2 py-1 rounded bg-zinc-500/20 text-zinc-400 text-xs font-bold">ì‚¬ìš©ì</span>
            {% endif %}
          </td>
          <td class="px-6 py-4">
            <button onclick="toggleCategory({{ cat.id }})" id="toggle-{{ cat.id }}"
                    class="px-3 py-1 rounded-full text-xs font-bold transition
                           {% if cat.is_active %}bg-green-500/10 text-green-400 border border-green-500/20{% else %}bg-zinc-500/10 text-zinc-400 border border-zinc-500/20{% endif %}">
              {{ "í™œì„±" if cat.is_active else "ë¹„í™œì„±" }}
            </button>
          </td>
          <td class="px-6 py-4 text-right">
            {% if not cat.is_system %}
              <button onclick="deleteCategory({{ cat.id }}, '{{ cat.name }}')" class="text-red-400 hover:underline text-sm font-bold">ì‚­ì œ</button>
            {% else %}
              <span class="text-zinc-600 text-sm">-</span>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function toggleCategory(id) {
  fetch(`/admin/categories/${id}/toggle`, { method: 'POST' })
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        const btn = document.getElementById(`toggle-${id}`);
        if (data.is_active) {
          btn.textContent = 'í™œì„±';
          btn.className = 'px-3 py-1 rounded-full text-xs font-bold transition bg-green-500/10 text-green-400 border border-green-500/20';
        } else {
          btn.textContent = 'ë¹„í™œì„±';
          btn.className = 'px-3 py-1 rounded-full text-xs font-bold transition bg-zinc-500/10 text-zinc-400 border border-zinc-500/20';
        }
      }
    });
}

function deleteCategory(id, name) {
  if (!confirm(`'${name}' ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = `/admin/categories/${id}/delete`;
  document.body.appendChild(form);
  form.submit();
}
</script>

{% endblock %}