{% extends "admin_base.html" %}
{% block title %}ê´€ë¦¬ì í™ˆ - MONEYING{% endblock %}

{% block page_title %}ê´€ë¦¬ì í™ˆ{% endblock %}
{% block page_desc %}MONEYING í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.{% endblock %}

{% block content_admin %}

<div class="space-y-4 md:space-y-5">

  <!-- ì„¹ì…˜ 1: ìš”ì•½ë°” -->
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-4 md:p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-bold text-white text-sm md:text-base">ğŸ“Š í˜„í™©</h2>
      <span class="text-zinc-500 text-xs">{{ today.strftime('%Y-%m-%d') }}</span>
    </div>
    <div class="grid grid-cols-3 md:grid-cols-5 gap-2 md:gap-3">
      <a href="/admin/users" class="bg-zinc-800/50 rounded-xl p-3 text-center hover:bg-zinc-700/50 transition block">
        <div class="text-lg md:text-xl font-black text-[#c4ff00]">+{{ today_users }}</div>
        <div class="text-zinc-500 text-[11px] md:text-xs mt-1">ì‹ ê·œ ê°€ì…</div>
      </a>
      <a href="/admin/users" class="bg-zinc-800/50 rounded-xl p-3 text-center hover:bg-zinc-700/50 transition block">
        <div class="text-lg md:text-xl font-black text-white">{{ user_count }}</div>
        <div class="text-zinc-500 text-[11px] md:text-xs mt-1">ê°€ì…ì</div>
      </a>
      <a href="/admin/subscriptions" class="bg-zinc-800/50 rounded-xl p-3 text-center hover:bg-zinc-700/50 transition block">
        <div class="text-lg md:text-xl font-black text-[#c4ff00]">{{ subscriber_count }}</div>
        <div class="text-zinc-500 text-[11px] md:text-xs mt-1">êµ¬ë…ì</div>
      </a>
      <a href="/admin/gallery" class="bg-zinc-800/50 rounded-xl p-3 text-center hover:bg-zinc-700/50 transition block">
        <div class="text-lg md:text-xl font-black text-white">{{ gallery_count }}</div>
        <div class="text-zinc-500 text-[11px] md:text-xs mt-1">ê°¤ëŸ¬ë¦¬</div>
      </a>
      <a href="/admin/store" class="bg-zinc-800/50 rounded-xl p-3 text-center hover:bg-zinc-700/50 transition block">
        <div class="text-lg md:text-xl font-black text-white">{{ store_count }}</div>
        <div class="text-zinc-500 text-[11px] md:text-xs mt-1">ìŠ¤í† ì–´</div>
      </a>
    </div>
  </div>

  <!-- ì„¹ì…˜ 2: ì•¡ì…˜ ì„¼í„° -->
  <div class="space-y-3">

    <!-- 2-1: ë§í¬ìš”ì²­ -->
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
      <div class="flex items-center justify-between px-4 md:px-5 py-3 border-b border-zinc-800">
        <div class="flex items-center gap-2">
          <span class="text-lg">ğŸ”—</span>
          <h3 class="font-bold text-sm text-white">ë§í¬ìš”ì²­</h3>
          {% if pending_links > 0 %}
            <span id="link-badge" class="px-2 py-0.5 bg-blue-500/20 text-blue-400 text-xs font-bold rounded-full">{{ pending_links }}</span>
          {% endif %}
        </div>
        {% if pending_links > 0 %}
          <a href="/admin/link-requests" class="text-[#c4ff00] text-xs hover:underline">ì „ì²´ ë³´ê¸° &rarr;</a>
        {% else %}
          <span class="text-zinc-600 text-xs">ì™„ë£Œ âœ“</span>
        {% endif %}
      </div>
      {% if pending_link_items %}
        <div class="divide-y divide-zinc-800/50">
          {% for lr in pending_link_items %}
          <div class="px-4 md:px-5 py-3" id="lr-row-{{ lr.id }}">
            <div class="flex items-center justify-between mb-2">
              <span class="text-white text-sm font-medium truncate">{{ lr.requester_email }}</span>
              <a href="{{ lr.original_url }}" target="_blank" class="text-zinc-500 text-xs hover:text-blue-400 truncate max-w-[200px] ml-2">{{ lr.original_url[:40] }}{% if lr.original_url|length > 40 %}...{% endif %}</a>
            </div>
            <div class="flex gap-2">
              <input type="text" id="lr-input-{{ lr.id }}" placeholder="ì¿ íŒ¡ URL ì…ë ¥"
                     class="flex-1 bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm focus:border-[#c4ff00] focus:outline-none min-w-0">
              <button onclick="saveLinkUrl({{ lr.id }})"
                      class="px-4 py-2 bg-[#c4ff00] text-black text-sm font-bold rounded-lg hover:bg-white transition shrink-0">
                ì €ì¥
              </button>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="px-4 py-3 text-center text-zinc-600 text-sm">ì²˜ë¦¬í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
      {% endif %}
    </div>

    <!-- 2-2: íŒë§¤ì ì‹ ì²­ -->
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
      <div class="flex items-center justify-between px-4 md:px-5 py-3 border-b border-zinc-800">
        <div class="flex items-center gap-2">
          <span class="text-lg">ğŸª</span>
          <h3 class="font-bold text-sm text-white">íŒë§¤ì ì‹ ì²­</h3>
          {% if pending_sellers > 0 %}
            <span id="seller-badge" class="px-2 py-0.5 bg-purple-500/20 text-purple-400 text-xs font-bold rounded-full">{{ pending_sellers }}</span>
          {% endif %}
        </div>
        {% if pending_sellers > 0 %}
          <a href="/admin/sellers" class="text-[#c4ff00] text-xs hover:underline">ì „ì²´ ë³´ê¸° &rarr;</a>
        {% else %}
          <span class="text-zinc-600 text-xs">ì™„ë£Œ âœ“</span>
        {% endif %}
      </div>
      {% if pending_seller_items %}
        <div class="divide-y divide-zinc-800/50">
          {% for u in pending_seller_items %}
          <div class="px-4 md:px-5 py-3 flex items-center justify-between gap-3" id="seller-row-{{ u.id }}">
            <div class="min-w-0">
              <div class="text-white text-sm font-medium truncate">{{ u.nickname or u.email }}</div>
              <div class="text-zinc-500 text-xs truncate">{{ u.email }}</div>
            </div>
            <div class="flex gap-2 shrink-0">
              <button onclick="sellerAction({{ u.id }}, 'approve')"
                      class="px-3 py-1.5 bg-green-600 hover:bg-green-500 text-white text-xs font-bold rounded-lg transition">ìŠ¹ì¸</button>
              <button onclick="sellerAction({{ u.id }}, 'reject')"
                      class="px-3 py-1.5 bg-zinc-700 hover:bg-red-600 text-zinc-300 hover:text-white text-xs font-bold rounded-lg transition">ê±°ì ˆ</button>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="px-4 py-3 text-center text-zinc-600 text-sm">ì²˜ë¦¬í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
      {% endif %}
    </div>

    <!-- 2-3: íŒë§¤ì ê²Œì‹œë¬¼ -->
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
      <div class="flex items-center justify-between px-4 md:px-5 py-3 border-b border-zinc-800">
        <div class="flex items-center gap-2">
          <span class="text-lg">ğŸ“¸</span>
          <h3 class="font-bold text-sm text-white">ê²Œì‹œë¬¼ ì‹ ì²­</h3>
          {% if pending_posts > 0 %}
            <span id="post-badge" class="px-2 py-0.5 bg-orange-500/20 text-orange-400 text-xs font-bold rounded-full">{{ pending_posts }}</span>
          {% endif %}
        </div>
        {% if pending_posts > 0 %}
          <a href="/admin/seller-posts" class="text-[#c4ff00] text-xs hover:underline">ì „ì²´ ë³´ê¸° &rarr;</a>
        {% else %}
          <span class="text-zinc-600 text-xs">ì™„ë£Œ âœ“</span>
        {% endif %}
      </div>
      {% if pending_post_items %}
        <div class="divide-y divide-zinc-800/50">
          {% for post in pending_post_items %}
          <div class="px-4 md:px-5 py-3 flex items-center justify-between gap-3" id="post-row-{{ post.id }}">
            <div class="min-w-0">
              <div class="text-white text-sm font-medium truncate">{{ post.title }}</div>
              <div class="text-zinc-500 text-xs truncate">{{ post.category or '-' }}</div>
            </div>
            <div class="flex gap-2 shrink-0">
              <button onclick="postAction({{ post.id }}, 'approve')"
                      class="px-3 py-1.5 bg-green-600 hover:bg-green-500 text-white text-xs font-bold rounded-lg transition">ìŠ¹ì¸</button>
              <button onclick="postAction({{ post.id }}, 'reject')"
                      class="px-3 py-1.5 bg-zinc-700 hover:bg-red-600 text-zinc-300 hover:text-white text-xs font-bold rounded-lg transition">ê±°ì ˆ</button>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="px-4 py-3 text-center text-zinc-600 text-sm">ì²˜ë¦¬í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
      {% endif %}
    </div>

    <!-- 2-4: ìˆ˜ìµì¸ì¦ -->
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
      <div class="flex items-center justify-between px-4 md:px-5 py-3 border-b border-zinc-800">
        <div class="flex items-center gap-2">
          <span class="text-lg">ğŸ’¸</span>
          <h3 class="font-bold text-sm text-white">ë¦¬ì›Œë“œ ìš”ì²­</h3>
          {% if pending_rewards > 0 %}
            <span id="reward-badge" class="px-2 py-0.5 bg-green-500/20 text-green-400 text-xs font-bold rounded-full">{{ pending_rewards }}</span>
          {% endif %}
        </div>
        {% if pending_rewards > 0 %}
          <a href="/admin/revenue-proofs" class="text-[#c4ff00] text-xs hover:underline">ì „ì²´ ë³´ê¸° &rarr;</a>
        {% else %}
          <span class="text-zinc-600 text-xs">ì™„ë£Œ âœ“</span>
        {% endif %}
      </div>
      {% if pending_reward_items %}
        <div class="divide-y divide-zinc-800/50">
          {% for proof in pending_reward_items %}
          <div class="px-4 md:px-5 py-3 flex items-center justify-between gap-3" id="reward-row-{{ proof.id }}">
            <div class="min-w-0">
              <div class="text-white text-sm font-medium truncate">{{ proof._user.email if proof._user else 'íƒˆí‡´ìœ ì €' }}</div>
              <div class="text-zinc-500 text-xs truncate">{{ proof._post.title[:20] if proof._post else 'ì‚­ì œëœ ê¸€' }}{% if proof._post and proof._post.title|length > 20 %}...{% endif %}</div>
            </div>
            <div class="flex gap-2 shrink-0">
              <button onclick="rewardAction({{ proof.id }}, 'approve')"
                      class="px-3 py-1.5 bg-green-600 hover:bg-green-500 text-white text-xs font-bold rounded-lg transition">ìŠ¹ì¸</button>
              <button onclick="rewardAction({{ proof.id }}, 'reject')"
                      class="px-3 py-1.5 bg-zinc-700 hover:bg-red-600 text-zinc-300 hover:text-white text-xs font-bold rounded-lg transition">ê±°ì ˆ</button>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="px-4 py-3 text-center text-zinc-600 text-sm">ì²˜ë¦¬í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
      {% endif %}
    </div>

  </div>

  <!-- ì„¹ì…˜ 3: ìµœê·¼ í™œë™ -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

    <!-- ìµœê·¼ ê°¤ëŸ¬ë¦¬ -->
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
      <div class="flex items-center justify-between px-4 md:px-5 py-3 border-b border-zinc-800">
        <div class="flex items-center gap-2 md:gap-3 min-w-0">
          <h3 class="font-bold text-sm">ìµœê·¼ ê°¤ëŸ¬ë¦¬</h3>
          <button id="homeBulkDeleteBtn" onclick="homeBulkDelete()" class="hidden px-2 py-1 rounded bg-red-500/20 text-red-400 text-xs font-bold hover:bg-red-500/30 transition shrink-0">
            <span id="homeSelectedCount">0</span>ê°œ ì‚­ì œ
          </button>
        </div>
        <a href="/admin/gallery" class="text-[#c4ff00] text-xs hover:underline shrink-0 ml-2">ì „ì²´ ë³´ê¸° &rarr;</a>
      </div>
      <div class="divide-y divide-zinc-800/50">
        {% for post in recent_posts %}
        <div class="px-4 md:px-5 py-3 flex items-center justify-between gap-2 home-post-row" data-id="{{ post.id }}">
          <div class="flex items-center gap-2 md:gap-3 min-w-0 flex-1">
            <input type="checkbox" class="home-post-checkbox w-4 h-4 rounded accent-[#c4ff00] shrink-0" value="{{ post.id }}" onchange="updateHomeSelectedCount()">
            {% set img_list = post.to_dict().images %}
            {% if img_list and img_list|length > 0 %}
            <img src="{% if img_list[0].startswith('/r2/') or img_list[0].startswith('http') %}{{ img_list[0] }}{% else %}/static/uploads/{{ img_list[0] }}{% endif %}" class="w-9 h-9 md:w-10 md:h-10 rounded-lg object-cover shrink-0">
            {% else %}
            <div class="w-9 h-9 md:w-10 md:h-10 rounded-lg bg-zinc-800 flex items-center justify-center shrink-0 text-sm">ğŸ¬</div>
            {% endif %}
            <div class="min-w-0 flex-1">
              <div class="text-white text-sm font-medium truncate">{{ post.title }}</div>
              <div class="text-zinc-500 text-xs truncate">{{ post.category }}</div>
            </div>
          </div>
          <a href="/admin/posts/{{ post.id }}/edit" class="text-zinc-500 hover:text-[#c4ff00] active:text-[#c4ff00] text-xs shrink-0 px-2 py-1">ìˆ˜ì •</a>
        </div>
        {% endfor %}
        {% if not recent_posts %}
        <div class="px-4 md:px-5 py-6 text-center text-zinc-500 text-sm">ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
        {% endif %}
      </div>
    </div>

    <!-- ìµœê·¼ ë§í¬ìš”ì²­ -->
    <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
      <div class="flex items-center justify-between px-4 md:px-5 py-3 border-b border-zinc-800">
        <h3 class="font-bold text-sm">ìµœê·¼ ë§í¬ìš”ì²­</h3>
        <a href="/admin/link-requests" class="text-[#c4ff00] text-xs hover:underline shrink-0">ì „ì²´ ë³´ê¸° &rarr;</a>
      </div>
      <div class="divide-y divide-zinc-800/50">
        {% for lr in recent_link_requests %}
        <div class="px-4 md:px-5 py-3 flex items-center justify-between gap-3">
          <div class="min-w-0 flex-1">
            <div class="text-white text-sm truncate">{{ lr.requester_email }}</div>
            <div class="text-zinc-500 text-xs truncate">{{ lr.original_url[:30] }}{% if lr.original_url|length > 30 %}...{% endif %}</div>
          </div>
          {% if lr.coupang_url %}
            <span class="text-green-400 text-xs shrink-0">ì™„ë£Œ âœ“</span>
          {% else %}
            <span class="text-yellow-400 text-xs shrink-0">ëŒ€ê¸°ì¤‘</span>
          {% endif %}
        </div>
        {% endfor %}
        {% if not recent_link_requests %}
        <div class="px-4 md:px-5 py-6 text-center text-zinc-500 text-sm">ë§í¬ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</div>
        {% endif %}
      </div>
    </div>

  </div>

</div>

<!-- ì¼ê´„ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div id="homeBulkDeleteModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
  <div class="bg-zinc-900 border border-zinc-700 rounded-2xl p-6 max-w-sm w-full text-center">
    <div class="text-5xl mb-4">ğŸ—‘ï¸</div>
    <h3 class="text-xl font-black text-white mb-2">ì¼ê´„ ì‚­ì œ</h3>
    <p class="text-zinc-400 mb-6"><span id="homeDeleteCountText">0</span>ê°œì˜ ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    <div class="flex gap-3">
      <button onclick="closeHomeBulkDeleteModal()" class="flex-1 py-3 rounded-xl font-bold bg-zinc-800 text-white hover:bg-zinc-700 active:bg-zinc-600 transition">ì·¨ì†Œ</button>
      <button onclick="confirmHomeBulkDelete()" class="flex-1 py-3 rounded-xl font-bold bg-red-500 text-white hover:bg-red-400 active:bg-red-600 transition">ì‚­ì œ</button>
    </div>
  </div>
</div>

<!-- ê²°ê³¼ ëª¨ë‹¬ -->
<div id="homeResultModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
  <div class="bg-zinc-900 border border-zinc-700 rounded-2xl p-6 max-w-sm w-full text-center">
    <div id="homeResultIcon" class="text-5xl mb-4">âœ…</div>
    <h3 id="homeResultTitle" class="text-xl font-black text-white mb-2">ì™„ë£Œ</h3>
    <p id="homeResultMessage" class="text-zinc-400 mb-6"></p>
    <button onclick="closeHomeResultModal()" class="w-full py-3 rounded-xl font-bold bg-[#c4ff00] text-black hover:bg-white active:bg-zinc-200 transition">í™•ì¸</button>
  </div>
</div>

<script>
/* ====== ë±ƒì§€ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ ====== */
function updateBadgeCount(badgeId, delta) {
  var badge = document.getElementById(badgeId);
  if (!badge) return;
  var count = parseInt(badge.textContent) + delta;
  if (count <= 0) {
    badge.remove();
  } else {
    badge.textContent = count;
  }
}

/* ====== ë§í¬ìš”ì²­ ì¸ë¼ì¸ ì €ì¥ ====== */
async function saveLinkUrl(id) {
  var input = document.getElementById('lr-input-' + id);
  var url = input.value.trim();
  if (!url) { input.focus(); return; }

  try {
    var res = await fetch('/api/link-request/' + id + '/update-url', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ coupang_url: url })
    });
    var data = await res.json();

    if (data.ok) {
      var row = document.getElementById('lr-row-' + id);
      row.innerHTML = '<div class="text-green-400 text-sm font-bold text-center py-2">ì™„ë£Œ âœ“</div>';
      updateBadgeCount('link-badge', -1);
    } else {
      alert(data.error || 'ì €ì¥ ì‹¤íŒ¨');
    }
  } catch (err) {
    alert('ì˜¤ë¥˜: ' + err.message);
  }
}

/* ====== íŒë§¤ì ìŠ¹ì¸/ê±°ì ˆ ====== */
async function sellerAction(userId, action) {
  if (!confirm(action === 'approve' ? 'ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' : 'ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    var res = await fetch('/admin/sellers/' + userId + '/' + action, { method: 'POST' });
    var data = await res.json();
    if (data.ok) {
      var row = document.getElementById('seller-row-' + userId);
      row.innerHTML = '<div class="text-' + (action === 'approve' ? 'green' : 'red') + '-400 text-sm font-bold text-center py-2 w-full">' + (action === 'approve' ? 'ìŠ¹ì¸ë¨ âœ“' : 'ê±°ì ˆë¨') + '</div>';
      updateBadgeCount('seller-badge', -1);
    }
  } catch (err) {
    alert('ì˜¤ë¥˜: ' + err.message);
  }
}

/* ====== íŒë§¤ì ê²Œì‹œë¬¼ ìŠ¹ì¸/ê±°ì ˆ ====== */
async function postAction(postId, action) {
  if (!confirm(action === 'approve' ? 'ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' : 'ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    var res = await fetch('/admin/seller-posts/' + postId + '/' + action, { method: 'POST' });
    var data = await res.json();
    if (data.ok) {
      var row = document.getElementById('post-row-' + postId);
      row.innerHTML = '<div class="text-' + (action === 'approve' ? 'green' : 'red') + '-400 text-sm font-bold text-center py-2 w-full">' + (action === 'approve' ? 'ìŠ¹ì¸ë¨ âœ“' : 'ê±°ì ˆë¨') + '</div>';
      updateBadgeCount('post-badge', -1);
    }
  } catch (err) {
    alert('ì˜¤ë¥˜: ' + err.message);
  }
}

/* ====== ìˆ˜ìµì¸ì¦ ìŠ¹ì¸/ê±°ì ˆ ====== */
async function rewardAction(proofId, action) {
  if (!confirm(action === 'approve' ? 'ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' : 'ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    var res = await fetch('/admin/revenue-proofs/' + proofId + '/' + action, {
      method: 'POST',
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    });
    var data = await res.json();
    if (data.ok) {
      var row = document.getElementById('reward-row-' + proofId);
      row.innerHTML = '<div class="text-' + (action === 'approve' ? 'green' : 'red') + '-400 text-sm font-bold text-center py-2 w-full">' + (action === 'approve' ? 'ìŠ¹ì¸ë¨ âœ“' : 'ê±°ì ˆë¨') + '</div>';
      updateBadgeCount('reward-badge', -1);
    }
  } catch (err) {
    alert('ì˜¤ë¥˜: ' + err.message);
  }
}

/* ====== ê°¤ëŸ¬ë¦¬ ë²Œí¬ ì‚­ì œ (ê¸°ì¡´ ìœ ì§€) ====== */
function updateHomeSelectedCount() {
  var checkboxes = document.querySelectorAll('.home-post-checkbox:checked');
  var count = checkboxes.length;
  var btn = document.getElementById('homeBulkDeleteBtn');
  var countSpan = document.getElementById('homeSelectedCount');
  if (count > 0) {
    btn.classList.remove('hidden');
    countSpan.textContent = count;
  } else {
    btn.classList.add('hidden');
  }
}

function homeBulkDelete() {
  var checkboxes = document.querySelectorAll('.home-post-checkbox:checked');
  document.getElementById('homeDeleteCountText').textContent = checkboxes.length;
  document.getElementById('homeBulkDeleteModal').classList.remove('hidden');
  document.getElementById('homeBulkDeleteModal').classList.add('flex');
}

function closeHomeBulkDeleteModal() {
  document.getElementById('homeBulkDeleteModal').classList.add('hidden');
  document.getElementById('homeBulkDeleteModal').classList.remove('flex');
}

async function confirmHomeBulkDelete() {
  var checkboxes = document.querySelectorAll('.home-post-checkbox:checked');
  var ids = Array.from(checkboxes).map(function(cb) { return parseInt(cb.value); });
  closeHomeBulkDeleteModal();
  try {
    var res = await fetch('/admin/gallery/bulk-delete', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ ids: ids })
    });
    var data = await res.json();
    if (data.ok) {
      showHomeResult('success', 'ì‚­ì œ ì™„ë£Œ', data.count + 'ê°œì˜ ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      ids.forEach(function(id) {
        var row = document.querySelector('.home-post-row[data-id="' + id + '"]');
        if (row) row.remove();
      });
      updateHomeSelectedCount();
    } else {
      showHomeResult('error', 'ì‚­ì œ ì‹¤íŒ¨', data.error);
    }
  } catch (err) {
    showHomeResult('error', 'ì˜¤ë¥˜ ë°œìƒ', err.message);
  }
}

function showHomeResult(type, title, message) {
  document.getElementById('homeResultIcon').textContent = type === 'success' ? 'âœ…' : 'âŒ';
  document.getElementById('homeResultTitle').textContent = title;
  document.getElementById('homeResultMessage').textContent = message;
  document.getElementById('homeResultModal').classList.remove('hidden');
  document.getElementById('homeResultModal').classList.add('flex');
}

function closeHomeResultModal() {
  document.getElementById('homeResultModal').classList.add('hidden');
  document.getElementById('homeResultModal').classList.remove('flex');
}
</script>

<style>
.no-scrollbar::-webkit-scrollbar { display: none; }
.no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>

{% endblock %}
