{% extends "base.html" %}
{% block title %}ê²°ì œ ë‚´ì—­ - MONEYING{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto">

  <div class="mb-6">
    <a href="/my" class="text-zinc-500 hover:text-white transition text-sm">&larr; ë‚´ì •ë³´</a>
    <h1 class="text-2xl font-black mt-2">ê²°ì œ ë‚´ì—­</h1>
    <p class="text-zinc-400 mt-1 text-sm">êµ¬ë§¤ ë° ê²°ì œ ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”</p>
  </div>

  {% if payments|length == 0 %}
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-10 text-center">
    <div class="text-4xl mb-4">ğŸ’³</div>
    <div class="text-zinc-400 font-bold mb-2">ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
    <p class="text-zinc-500 text-sm mb-4">êµ¬ë… ê²°ì œ í›„ ì´ê³³ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”</p>
    <a href="/pricing" class="inline-block bg-[#c4ff00] text-black font-bold px-6 py-3 rounded-xl hover:bg-white transition">
      ìš”ê¸ˆì œ ë³´ê¸°
    </a>
  </div>
  {% else %}

  {% set plan_names = {
    'gallery': 'ì˜ìƒ ê°¤ëŸ¬ë¦¬',
    'allinone': 'ì˜¬ì¸ì› íŒ¨í‚¤ì§€',
    'profitguard_lite': 'í”„ë¡œí•ê°€ë“œ ë¼ì´íŠ¸',
    'profitguard_pro': 'í”„ë¡œí•ê°€ë“œ PRO',
    'profitguard_lifetime': 'í”„ë¡œí•ê°€ë“œ í‰ìƒ'
  } %}

  <div class="space-y-3">
    {% for payment in payments %}
    {% set is_store = payment.plan_type.startswith('store_') %}
    {% set store_pid = payment.plan_type.replace('store_', '') if is_store else '' %}
    {% set product = store_products.get(store_pid|int) if is_store and store_pid.isdigit() else None %}

    <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4">
      <div class="flex items-center justify-between mb-2">
        <span class="font-bold text-white">
          {% if product %}
            {{ product.title }}
          {% elif is_store %}
            ì§€ì‹ìŠ¤í† ì–´ ìƒí’ˆ
          {% else %}
            {{ plan_names.get(payment.plan_type, payment.plan_type) }}
          {% endif %}
        </span>
        <span class="{% if payment.status == 'paid' %}text-green-400{% elif payment.status == 'refunded' %}text-red-400{% else %}text-zinc-400{% endif %} text-sm font-bold">
          {% if payment.status == 'paid' %}ê²°ì œì™„ë£Œ{% elif payment.status == 'refunded' %}í™˜ë¶ˆ{% elif payment.status == 'cancelled' %}ì·¨ì†Œ{% else %}{{ payment.status }}{% endif %}
        </span>
      </div>
      <div class="flex items-center justify-between text-sm">
        <span class="text-zinc-500">{% if payment.paid_at %}{{ payment.paid_at.strftime('%Y-%m-%d %H:%M') }}{% else %}{{ payment.created_at.strftime('%Y-%m-%d %H:%M') }}{% endif %}</span>
        <span class="text-white font-bold">{{ "{:,}".format(payment.amount) }}ì›</span>
      </div>

      {% if product and payment.status == 'paid' %}
      <div class="flex gap-2 mt-3 pt-3 border-t border-zinc-800">
        {% if product.file_url or product.file_url2 %}
          {% if product.file_url %}
          <a href="{{ product.file_url }}" target="_blank"
             class="flex-1 bg-[#c4ff00] text-black font-bold py-2 rounded-lg text-center text-sm hover:bg-white transition">
            <i class="fas fa-{% if 'notion' in (product.file_url|lower) %}link{% else %}download{% endif %} mr-1"></i>{% if product.file_url2 %}{% if 'notion' in (product.file_url|lower) %}ë…¸ì…˜ ì—´ê¸°{% else %}ë§í¬ ì—´ê¸°{% endif %}{% else %}ì½˜í…ì¸  ì—´ê¸°{% endif %}
          </a>
          {% endif %}
          {% if product.file_url2 %}
          <a href="{{ product.file_url2 }}" target="_blank"
             class="flex-1 bg-white text-black font-bold py-2 rounded-lg text-center text-sm hover:bg-zinc-200 transition">
            <i class="fas fa-{% if 'pdf' in (product.file_url2|lower) %}file-pdf{% else %}download{% endif %} mr-1"></i>{% if 'pdf' in (product.file_url2|lower) %}PDF ë‹¤ìš´ë¡œë“œ{% else %}íŒŒì¼ ë‹¤ìš´ë¡œë“œ{% endif %}
          </a>
          {% endif %}
        {% else %}
          <a href="/store/{{ product.id }}"
             class="flex-1 bg-zinc-700 text-white font-bold py-2 rounded-lg text-center text-sm hover:bg-zinc-600 transition">
            ìƒí’ˆ ë³´ê¸°
          </a>
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  {% endif %}

  <!-- ì•ˆë‚´ -->
  <div class="mt-6 bg-zinc-900/40 border border-zinc-800 rounded-xl p-4">
    <div class="text-zinc-500 text-xs">
      <p class="font-bold text-zinc-400 mb-2">ì•ˆë‚´</p>
      <p>â€¢ êµ¬ë… ì„œë¹„ìŠ¤ëŠ” ë§¤ì›” ìë™ ê²°ì œë©ë‹ˆë‹¤</p>
      <p>â€¢ ë””ì§€í„¸ ìƒí’ˆì€ êµ¬ë§¤ í›„ í™˜ë¶ˆì´ ë¶ˆê°€í•©ë‹ˆë‹¤</p>
      <p>â€¢ ë¬¸ì˜: <a href="/support" class="text-[#c4ff00] hover:underline">ê³ ê°ì„¼í„°</a></p>
    </div>
  </div>

</div>

{% endblock %}