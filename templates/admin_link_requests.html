{% extends "admin_base.html" %}
{% block title %}ë§í¬ìš”ì²­ ê´€ë¦¬ - MONEYING Admin{% endblock %}
{% block page_title %}ë§í¬ìš”ì²­ ê´€ë¦¬{% endblock %}
{% block page_desc %}ì´ {{ pagination.total if pagination else items|length }}ê±´{% endblock %}
{% block content_admin %}

<!-- ê²€ìƒ‰/í•„í„° -->
<div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-4 mb-4">
  <form method="GET" class="flex flex-col md:flex-row gap-3">
    <div class="flex gap-2">
      <a href="?status=all&q={{ search }}" class="px-3 py-1.5 rounded-lg text-sm font-bold {% if status_filter == 'all' %}bg-[#c4ff00] text-black{% else %}bg-zinc-800 text-zinc-400 hover:text-white{% endif %} transition">ì „ì²´</a>
      <a href="?status=pending&q={{ search }}" class="px-3 py-1.5 rounded-lg text-sm font-bold {% if status_filter == 'pending' %}bg-yellow-500 text-black{% else %}bg-zinc-800 text-zinc-400 hover:text-white{% endif %} transition">ëŒ€ê¸°ì¤‘</a>
      <a href="?status=done&q={{ search }}" class="px-3 py-1.5 rounded-lg text-sm font-bold {% if status_filter == 'done' %}bg-green-500 text-black{% else %}bg-zinc-800 text-zinc-400 hover:text-white{% endif %} transition">ì™„ë£Œ</a>
    </div>
    <div class="flex-1 flex gap-2">
      <input type="hidden" name="status" value="{{ status_filter }}">
      <input type="text" name="q" value="{{ search }}" placeholder="ì´ë©”ì¼, URL, ì œëª© ê²€ìƒ‰..."
             class="flex-1 px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white text-sm focus:border-[#c4ff00] focus:outline-none">
      <button type="submit" class="px-4 py-2 bg-zinc-700 text-white rounded-lg text-sm font-bold hover:bg-zinc-600 transition">ê²€ìƒ‰</button>
    </div>
  </form>
</div>

<div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
  <div class="flex items-center justify-between px-4 md:px-5 py-3 md:py-4 border-b border-zinc-800">
    <div class="font-black text-sm md:text-base">ë§í¬ìš”ì²­ ëª©ë¡</div>
  </div>
  {% if items|length == 0 %}
    <div class="p-10 text-center">
      <div class="text-4xl mb-4">ğŸ”—</div>
      <div class="text-zinc-500 font-bold">ë§í¬ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</div>
    </div>
  {% else %}

    <!-- PC í…Œì´ë¸” -->
    <div class="hidden md:block">
      <table class="w-full">
        <thead class="bg-zinc-800/50">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ID</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ìš”ì²­ì</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì›ë³¸ URL</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ìƒíƒœ</th>
            <th class="px-6 py-4 text-right text-xs font-bold text-zinc-500 uppercase">ì•¡ì…˜</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-zinc-800/70">
          {% for it in items %}
            <tr class="hover:bg-zinc-800/30 transition">
              <td class="px-6 py-4 text-zinc-400">#{{ it.id }}</td>
              <td class="px-6 py-4 text-white font-bold">{{ it.requester_email }}</td>
              <td class="px-6 py-4">
                <a href="{{ it.original_url }}" target="_blank" class="text-zinc-400 hover:text-[#a3e635] truncate block max-w-xs">
                  {{ it.original_url[:50] }}{% if it.original_url|length > 50 %}...{% endif %}
                </a>
              </td>
              <td class="px-6 py-4">
                {% if it.coupang_url %}
                  <span class="px-3 py-1 rounded-full bg-green-500/10 text-green-400 border border-green-500/20 text-xs font-bold">ì™„ë£Œ</span>
                {% else %}
                  <span class="px-3 py-1 rounded-full bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 text-xs font-bold">ëŒ€ê¸°ì¤‘</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 text-right">
                <a href="/link-requests/{{ it.id }}" class="text-[#a3e635] hover:underline text-sm font-bold">
                  {% if it.coupang_url %}ë³´ê¸°{% else %}ì…ë ¥{% endif %}
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- ëª¨ë°”ì¼ ì¹´ë“œ -->
    <div class="md:hidden divide-y divide-zinc-800/50">
      {% for it in items %}
        <a href="/link-requests/{{ it.id }}" class="block px-4 py-3 active:bg-zinc-800/50 transition">
          <div class="flex items-center justify-between mb-1">
            <div class="font-medium text-white text-sm truncate mr-2">{{ it.requester_email }}</div>
            {% if it.coupang_url %}
              <span class="px-2 py-0.5 rounded bg-green-500/10 text-green-400 text-[11px] font-bold shrink-0">ì™„ë£Œ</span>
            {% else %}
              <span class="px-2 py-0.5 rounded bg-yellow-500/10 text-yellow-400 text-[11px] font-bold shrink-0">ëŒ€ê¸°ì¤‘</span>
            {% endif %}
          </div>
          <div class="flex items-center gap-2 text-xs text-zinc-500">
            <span>#{{ it.id }}</span>
            <span class="truncate">{{ it.original_url[:40] }}{% if it.original_url|length > 40 %}...{% endif %}</span>
          </div>
        </a>
      {% endfor %}
    </div>

  {% endif %}
</div>

{% if pagination and pagination.pages > 1 %}
<div class="flex justify-center gap-2 mt-4">
  {% if pagination.has_prev %}
  <a href="?page={{ pagination.prev_num }}&status={{ status_filter }}&q={{ search }}" class="px-4 py-2 bg-zinc-800 text-white rounded-lg hover:bg-zinc-700 transition text-sm">â† ì´ì „</a>
  {% endif %}
  <span class="px-4 py-2 text-zinc-500 text-sm">{{ pagination.page }} / {{ pagination.pages }}</span>
  {% if pagination.has_next %}
  <a href="?page={{ pagination.next_num }}&status={{ status_filter }}&q={{ search }}" class="px-4 py-2 bg-zinc-800 text-white rounded-lg hover:bg-zinc-700 transition text-sm">ë‹¤ìŒ â†’</a>
  {% endif %}
</div>
{% endif %}
{% endblock %}
