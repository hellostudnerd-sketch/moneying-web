{% extends "admin_base.html" %}
{% block title %}íŒë§¤ì ê´€ë¦¬{% endblock %}
{% block page_title %}íŒë§¤ì ê´€ë¦¬{% endblock %}
{% block page_desc %}íŒë§¤ì ì „í™˜ ì‹ ì²­ ëª©ë¡{% endblock %}

{% block content_admin %}

  <!-- í•„í„° íƒ­ -->
  <div class="flex gap-2 mb-6">
    <a href="?status=pending" class="px-4 py-2 rounded-lg font-bold text-sm transition {% if status_filter == 'pending' %}bg-[#a3e635] text-black{% else %}bg-zinc-800 text-zinc-400 hover:bg-zinc-700{% endif %}">
      ëŒ€ê¸°ì¤‘
    </a>
    <a href="?status=approved" class="px-4 py-2 rounded-lg font-bold text-sm transition {% if status_filter == 'approved' %}bg-[#a3e635] text-black{% else %}bg-zinc-800 text-zinc-400 hover:bg-zinc-700{% endif %}">
      ìŠ¹ì¸ë¨
    </a>
    <a href="?status=rejected" class="px-4 py-2 rounded-lg font-bold text-sm transition {% if status_filter == 'rejected' %}bg-[#a3e635] text-black{% else %}bg-zinc-800 text-zinc-400 hover:bg-zinc-700{% endif %}">
      ê±°ì ˆë¨
    </a>
    <a href="?status=all" class="px-4 py-2 rounded-lg font-bold text-sm transition {% if status_filter == 'all' %}bg-[#a3e635] text-black{% else %}bg-zinc-800 text-zinc-400 hover:bg-zinc-700{% endif %}">
      ì „ì²´
    </a>
  </div>

  <!-- ëª©ë¡ -->
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
    {% if users|length == 0 %}
      <div class="p-10 text-center">
        <div class="text-4xl mb-4">ğŸ“‹</div>
        <div class="text-zinc-500 font-bold">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    {% else %}
      <table class="w-full">
        <thead class="bg-zinc-800/50">
          <tr>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì´ë©”ì¼</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì—…ì²´ëª…</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì¹´í…Œê³ ë¦¬</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ì‹ ì²­ì¼</th>
            <th class="px-6 py-4 text-left text-xs font-bold text-zinc-500 uppercase">ìƒíƒœ</th>
            <th class="px-6 py-4 text-right text-xs font-bold text-zinc-500 uppercase">ì•¡ì…˜</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-zinc-800/70">
          {% for user in users %}
            <tr class="hover:bg-zinc-800/30 transition" id="row-{{ user.id }}">
              <td class="px-6 py-4">
                <div class="font-bold text-white">{{ user.email }}</div>
              </td>
              <td class="px-6 py-4 text-zinc-300">{{ user.seller_company or '-' }}</td>
              <td class="px-6 py-4 text-zinc-300">{{ user.seller_category or '-' }}</td>
              <td class="px-6 py-4 text-zinc-500 text-sm">{{ user.seller_applied_at.strftime('%Y-%m-%d') if user.seller_applied_at else '-' }}</td>
              <td class="px-6 py-4">
                {% if user.seller_status == 'approved' %}
                  <span class="px-3 py-1 rounded-full bg-green-500/10 text-green-400 border border-green-500/20 text-xs font-bold">ìŠ¹ì¸ë¨</span>
                {% elif user.seller_status == 'pending' %}
                  <span class="px-3 py-1 rounded-full bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 text-xs font-bold">ëŒ€ê¸°ì¤‘</span>
                {% else %}
                  <span class="px-3 py-1 rounded-full bg-red-500/10 text-red-400 border border-red-500/20 text-xs font-bold">ê±°ì ˆë¨</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 text-right">
                {% if user.seller_status == 'pending' %}
                  <button onclick="showModal('approve', {{ user.id }}, '{{ user.email }}')" class="px-3 py-1 bg-green-600 hover:bg-green-500 text-white rounded text-sm font-bold mr-2">ìŠ¹ì¸</button>
                  <button onclick="showModal('reject', {{ user.id }}, '{{ user.email }}')" class="px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded text-sm font-bold">ê±°ì ˆ</button>
                {% elif user.seller_status == 'approved' %}
                  <span class="text-zinc-500 text-sm mr-2">í™œë™ì¤‘</span>
                  <button onclick="showModal('revoke', {{ user.id }}, '{{ user.email }}')" class="px-3 py-1 bg-orange-600 hover:bg-orange-500 text-white rounded text-sm font-bold">í•´ì œ</button>
                {% else %}
                  <button onclick="showModal('approve', {{ user.id }}, '{{ user.email }}')" class="px-3 py-1 bg-zinc-700 hover:bg-zinc-600 text-white rounded text-sm font-bold">ì¬ìŠ¹ì¸</button>
                {% endif %}
              </td>
            </tr>
            {% if user.seller_intro %}
              <tr class="bg-zinc-900/30">
                <td colspan="6" class="px-6 py-3">
                  <div class="text-zinc-500 text-sm">
                    <strong class="text-zinc-400">ì†Œê°œ:</strong> {{ user.seller_intro }}
                  </div>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>

</div>

<!-- í™•ì¸ ëª¨ë‹¬ -->
<div id="confirmModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center">
  <div class="bg-zinc-900 border border-zinc-700 rounded-2xl p-6 max-w-sm mx-4 text-center">
    <div id="modalIcon" class="text-5xl mb-4">âœ…</div>
    <h3 id="modalTitle" class="text-xl font-black text-white mb-2">ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
    <p id="modalDesc" class="text-zinc-400 text-sm mb-6">ì´ë©”ì¼</p>
    <div class="flex gap-3">
      <button onclick="closeModal()" class="flex-1 py-3 rounded-xl font-bold border border-zinc-600 text-white hover:bg-zinc-800 transition">ì·¨ì†Œ</button>
      <button id="modalConfirmBtn" onclick="confirmAction()" class="flex-1 py-3 rounded-xl font-bold bg-green-500 text-black hover:bg-green-400 transition">í™•ì¸</button>
    </div>
  </div>
</div>

<script>
let currentAction = '';
let currentUserId = null;

function showModal(action, userId, email) {
  currentAction = action;
  currentUserId = userId;
  
  const modal = document.getElementById('confirmModal');
  const icon = document.getElementById('modalIcon');
  const title = document.getElementById('modalTitle');
  const desc = document.getElementById('modalDesc');
  const btn = document.getElementById('modalConfirmBtn');
  
  if (action === 'approve') {
    icon.textContent = 'âœ…';
    title.textContent = 'íŒë§¤ì ìŠ¹ì¸';
    desc.textContent = `${email} ë‹˜ì„ íŒë§¤ìë¡œ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
    btn.className = 'flex-1 py-3 rounded-xl font-bold bg-green-500 text-black hover:bg-green-400 transition';
    btn.textContent = 'ìŠ¹ì¸';
  } else if (action === 'revoke') {

    icon.textContent = 'âš ï¸';

    title.textContent = 'íŒë§¤ì í•´ì œ';

    desc.textContent = `${email} ë‹˜ì˜ íŒë§¤ì ìê²©ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;

    btn.className = 'flex-1 py-3 rounded-xl font-bold bg-orange-500 text-black hover:bg-orange-400 transition';

    btn.textContent = 'í•´ì œ';

  } else {

    icon.textContent = 'âŒ';
    title.textContent = 'íŒë§¤ì ê±°ì ˆ';
    desc.textContent = `${email} ë‹˜ì˜ ì‹ ì²­ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
    btn.className = 'flex-1 py-3 rounded-xl font-bold bg-red-500 text-white hover:bg-red-400 transition';
    btn.textContent = 'ê±°ì ˆ';
  }
  
  modal.classList.remove('hidden');
  modal.classList.add('flex');
}

function closeModal() {
  const modal = document.getElementById('confirmModal');
  modal.classList.add('hidden');
  modal.classList.remove('flex');
  currentAction = '';
  currentUserId = null;
}

function confirmAction() {
  if (!currentUserId) return;
  
  const url = currentAction === 'approve'
    ? `/admin/sellers/${currentUserId}/approve`
    : currentAction === 'revoke' ? `/admin/sellers/${currentUserId}/revoke`
    : `/admin/sellers/${currentUserId}/reject`;
  
  fetch(url, { method: 'POST' })
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        closeModal();
        location.reload();
      } else {
        alert('ì˜¤ë¥˜: ' + (data.error || 'unknown'));
      }
    });
}

// ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ì‹œ ë‹«ê¸°
document.getElementById('confirmModal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});
</script>

{% endblock %}