{% extends "admin_base.html" %}
{% block title %}í†µê³„ - MONEYING{% endblock %}
{% block page_title %}í†µê³„ ëŒ€ì‹œë³´ë“œ{% endblock %}
{% block page_desc %}ê°€ì…ì, êµ¬ë…, ì½˜í…ì¸  í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.{% endblock %}

{% block content_admin %}

<!-- í•µì‹¬ ì§€í‘œ -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6">
    <div class="text-zinc-500 text-xs font-bold mb-1">ì´ ê°€ì…ì</div>
    <div class="text-3xl font-black">{{ total_users }}</div>
    <div class="text-green-400 text-sm mt-1">+{{ new_users_today }} ì˜¤ëŠ˜</div>
  </div>
  
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6">
    <div class="text-zinc-500 text-xs font-bold mb-1">êµ¬ë…ì</div>
    <div class="text-3xl font-black text-[#a3e635]">{{ total_subscribers }}</div>
    <div class="text-zinc-400 text-sm mt-1">ì „í™˜ìœ¨ {{ conversion_rate }}%</div>
  </div>
  
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6">
    <div class="text-zinc-500 text-xs font-bold mb-1">ì²´í—˜ì¤‘</div>
    <div class="text-3xl font-black text-purple-400">{{ trial_users }}</div>
    <div class="text-zinc-400 text-sm mt-1">ë¬´ë£Œì²´í—˜ ì´ìš©ì¤‘</div>
  </div>
  
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6">
    <div class="text-zinc-500 text-xs font-bold mb-1">ê°¤ëŸ¬ë¦¬</div>
    <div class="text-3xl font-black">{{ total_posts }}</div>
    <div class="text-zinc-400 text-sm mt-1">ì´ ê²Œì‹œë¬¼</div>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
  
  <!-- ìµœê·¼ 7ì¼ ê°€ì…ì -->
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6">
    <h3 class="font-black mb-4">ğŸ“ˆ ìµœê·¼ 7ì¼ ê°€ì…ì</h3>
    <div class="h-48 flex items-end justify-between gap-2">
      {% for day in daily_signups %}
        <div class="flex-1 flex flex-col items-center">
          <div class="w-full bg-[#a3e635]/20 rounded-t relative" style="height: {{ (day.count / max_daily_signup * 100) if max_daily_signup > 0 else 0 }}%">
            <div class="absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-bold text-[#a3e635]">{{ day.count }}</div>
          </div>
          <div class="text-zinc-500 text-xs mt-2">{{ day.label }}</div>
        </div>
      {% endfor %}
    </div>
  </div>
  
  <!-- êµ¬ë… í˜„í™© -->
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6">
    <h3 class="font-black mb-4">ğŸ’³ êµ¬ë… íƒ€ì…ë³„ í˜„í™©</h3>
    <div class="space-y-3">
      {% for plan in plan_stats %}
        <div>
          <div class="flex justify-between text-sm mb-1">
            <span class="text-zinc-400">{{ plan.name }}</span>
            <span class="font-bold">{{ plan.count }}ëª…</span>
          </div>
          <div class="w-full bg-zinc-800 rounded-full h-2">
            <div class="bg-[#a3e635] h-2 rounded-full" style="width: {{ (plan.count / total_subscribers * 100) if total_subscribers > 0 else 0 }}%"></div>
          </div>
        </div>
      {% endfor %}
      {% if plan_stats|length == 0 %}
        <div class="text-zinc-600 text-center py-8">êµ¬ë… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      {% endif %}
    </div>
  </div>

</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

  <!-- ì¸ê¸° ì˜ìƒ TOP 10 -->
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
    <div class="px-6 py-4 border-b border-zinc-800">
      <h3 class="font-black">ğŸ”¥ ì¸ê¸° ì˜ìƒ TOP 10</h3>
    </div>
    {% if popular_posts|length == 0 %}
      <div class="p-6 text-center text-zinc-600">ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    {% else %}
      <div class="divide-y divide-zinc-800/50">
        {% for p in popular_posts %}
          <div class="flex items-center gap-4 px-6 py-3 hover:bg-zinc-800/30 transition">
            <div class="text-lg font-black text-zinc-600 w-6">{{ loop.index }}</div>
            {% set img_list = p.to_dict().images %}
            {% if img_list and img_list|length > 0 %}
              <img src="/static/uploads/{{ img_list[0] }}" class="w-10 h-10 rounded object-cover">
            {% else %}
              <div class="w-10 h-10 rounded bg-zinc-800"></div>
            {% endif %}
            <div class="flex-1 min-w-0">
              <div class="font-bold truncate">{{ p.title }}</div>
              <div class="text-zinc-500 text-xs">{{ p.category or 'all' }}</div>
            </div>
            <div class="text-right shrink-0">
              <div class="font-bold text-[#a3e635]">{{ p.view_count }}</div>
              <div class="text-zinc-500 text-xs">ì¡°íšŒ</div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- ìµœê·¼ ê°€ì…ì -->
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl overflow-hidden">
    <div class="px-6 py-4 border-b border-zinc-800">
      <h3 class="font-black">ğŸ‘¤ ìµœê·¼ ê°€ì…ì</h3>
    </div>
    {% if recent_users|length == 0 %}
      <div class="p-6 text-center text-zinc-600">ê°€ì…ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    {% else %}
      <div class="divide-y divide-zinc-800/50">
        {% for u in recent_users %}
          <div class="flex items-center justify-between px-6 py-3 hover:bg-zinc-800/30 transition">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center text-sm">
                {% if u.free_trial_expires %}ğŸ{% else %}ğŸ‘¤{% endif %}
              </div>
              <div>
                <div class="font-bold text-sm">{{ u.email }}</div>
                <div class="text-zinc-500 text-xs">{{ u.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
              </div>
            </div>
            <div class="text-xs">
              {% if u.free_trial_expires %}
                <span class="px-2 py-1 rounded bg-purple-500/20 text-purple-400">ì²´í—˜ì¤‘</span>
              {% else %}
                <span class="px-2 py-1 rounded bg-zinc-800 text-zinc-500">ì¼ë°˜</span>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

</div>

{% endblock %}