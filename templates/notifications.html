{% extends "base.html" %}
{% block title %}ì•Œë¦¼ - MONEYING{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto">
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-black mb-2">ğŸ”” ì•Œë¦¼</h1>
      <p class="text-zinc-400">ìµœê·¼ í™œë™ ì•Œë¦¼ì„ í™•ì¸í•˜ì„¸ìš”.</p>
    </div>
    {% if notifications %}
    <button onclick="deleteAllNotifications()" class="text-zinc-500 hover:text-red-400 text-sm transition">
      <i class="fas fa-trash-alt mr-1"></i>ì „ì²´ ì‚­ì œ
    </button>
    {% endif %}
  </div>
  
  {% if notifications %}
  <div class="space-y-3" id="notiList">
    {% for noti in notifications %}
    <div class="noti-item bg-zinc-900/60 border border-zinc-800 rounded-xl p-4 hover:border-zinc-600 transition {% if not noti.is_read %}border-l-4 border-l-[#c4ff00]{% endif %}" data-id="{{ noti.id }}">
      <div class="flex items-start gap-3">
        <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0
          {% if noti.type == 'deal_approved' %}bg-green-500/20 text-green-400
          {% elif noti.type == 'deal_rejected' %}bg-red-500/20 text-red-400
          {% elif noti.type == 'reward' %}bg-yellow-500/20 text-yellow-400
          {% elif noti.type == 'comment' %}bg-blue-500/20 text-blue-400
          {% elif noti.type == 'link_completed' %}bg-blue-500/20 text-blue-400
          {% else %}bg-zinc-700 text-zinc-400{% endif %}">
          {% if noti.type == 'deal_approved' %}
            <i class="fas fa-check"></i>
          {% elif noti.type == 'deal_rejected' %}
            <i class="fas fa-times"></i>
          {% elif noti.type == 'reward' %}
            <i class="fas fa-gift"></i>
          {% elif noti.type == 'comment' %}
            <i class="fas fa-comment"></i>
          {% elif noti.type == 'link_completed' %}
            <i class="fas fa-link"></i>
          {% else %}
            <i class="fas fa-bell"></i>
          {% endif %}
        </div>
        <a href="{{ noti.link or '#' }}" class="flex-1 min-w-0">
          <p class="font-bold text-white">{{ noti.title }}</p>
          <p class="text-sm text-zinc-400 mt-1">{{ noti.message }}</p>
          <p class="text-xs text-zinc-500 mt-2">
            {{ (noti.created_at + timedelta(hours=9)).strftime('%Y.%m.%d %H:%M') if noti.created_at else '' }}
          </p>
        </a>
        <button onclick="deleteNotification({{ noti.id }})" class="text-zinc-600 hover:text-red-400 transition p-2">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-12 text-center">
    <div class="w-16 h-16 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4">
      <i class="fas fa-bell-slash text-2xl text-zinc-500"></i>
    </div>
    <p class="text-zinc-400">ì•„ì§ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  </div>
  {% endif %}
</div>

<script>

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì½ìŒ ì²˜ë¦¬
fetch("/api/notifications/mark-read", { method: "POST", credentials: "include" });
function deleteNotification(id) {
  fetch(`/api/notifications/${id}/delete`, { method: 'POST' })
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        document.querySelector(`.noti-item[data-id="${id}"]`).remove();
        if (document.querySelectorAll('.noti-item').length === 0) {
          location.reload();
        }
      }
    });
}

function deleteAllNotifications() {
  if (!confirm('ëª¨ë“  ì•Œë¦¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  fetch('/api/notifications/delete-all', { method: 'POST' })
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        location.reload();
      }
    });
}
</script>
{% endblock %}
