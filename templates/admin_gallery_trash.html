{% extends "admin_base.html" %}

{% block title %}휴지통 - 갤러리{% endblock %}

{% block page_title %}갤러리 휴지통{% endblock %}

{% block page_desc %}삭제된 게시물을 복원할 수 있습니다.{% endblock %}

{% block content %}

<div class="flex items-center justify-between mb-4">

  <a href="/admin/gallery" class="text-zinc-500 hover:text-white text-sm">&larr; 갤러리로 돌아가기</a>

  {% if posts %}

  <div class="flex gap-2">

    <button onclick="restoreSelected()" id="restoreSelectedBtn" class="hidden px-4 py-2 bg-[#c4ff00] text-black font-bold rounded-lg hover:bg-white transition text-sm">선택 복원</button>

    <form method="POST" action="/admin/gallery/restore-all" onsubmit="return confirm('전체 복원하시겠습니까?');">

      <button type="submit" class="px-4 py-2 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-500 transition text-sm">전체 복원 ({{ posts|length }}개)</button>

    </form>

  </div>

  {% endif %}

</div>

{% if posts %}

<div class="space-y-2">

  {% for p in posts %}

  <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4 flex items-center gap-3 hover:border-zinc-700 transition">

    <input type="checkbox" class="trash-checkbox w-4 h-4 rounded accent-[#c4ff00]" value="{{ p.id }}" onchange="updateTrashSelection()">

    <div class="flex-1 min-w-0">

      <span class="font-bold text-white">{{ p.title }}</span>

      <span class="text-zinc-500 text-xs ml-2">{{ (p.created_at|string)[:10] }}</span>

    </div>

    <form method="POST" action="/admin/gallery/restore/{{ p.id }}">

      <button type="submit" class="px-3 py-1.5 bg-zinc-800 text-white font-bold rounded-lg hover:bg-zinc-700 transition text-xs">복원</button>

    </form>

  </div>

  {% endfor %}

</div>

{% else %}

<div class="text-center text-zinc-500 py-20">휴지통이 비어있습니다.</div>

{% endif %}



<script>

function updateTrashSelection() {

  var checked = document.querySelectorAll(".trash-checkbox:checked");

  var btn = document.getElementById("restoreSelectedBtn");

  if (checked.length > 0) {

    btn.style.display = "block";

    btn.textContent = checked.length + "개 복원";

  } else {

    btn.style.display = "none";

  }

}

function restoreSelected() {

  var ids = [];

  document.querySelectorAll(".trash-checkbox:checked").forEach(function(cb) { ids.push(cb.value); });

  if (ids.length === 0) return;

  fetch("/admin/gallery/restore-selected", {

    method: "POST",

    headers: {"Content-Type": "application/json"},

    body: JSON.stringify({ids: ids})

  }).then(function(r) { return r.json(); })

  .then(function(d) { if (d.ok) location.reload(); });

}

</script>

{% endblock %}

