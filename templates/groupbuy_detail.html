{% extends "base.html" %}
{% block title %}{{ item.title }} - ê³µêµ¬/í˜‘ì°¬{% endblock %}

{% block head_extra %}
<style>
:root {
  --neon-lime: #c4ff00;
}

/* ===== ë©”ì¸ ì¹´ë“œ ===== */
.detail-card {
  background: linear-gradient(135deg, rgba(24, 24, 27, 0.9), rgba(9, 9, 11, 0.95));
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.08);
}

/* ===== ë°°ì§€ ===== */
.badge-groupbuy {
  background: var(--neon-lime);
  color: #000;
  box-shadow: 0 0 15px rgba(196, 255, 0, 0.4);
}
.badge-sponsor {
  background: linear-gradient(135deg, #a855f7, #ec4899);
  color: #fff;
  box-shadow: 0 0 15px rgba(168, 85, 247, 0.4);
}
.badge-subscriber {
  background: rgba(196, 255, 0, 0.1);
  border: 1px solid rgba(196, 255, 0, 0.3);
  color: var(--neon-lime);
}
.badge-closed {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  color: #ef4444;
}

/* ===== ì§„í–‰ë¥  ë°” ===== */
.progress-bar {
  background: rgba(255,255,255,0.1);
  overflow: hidden;
}
.progress-fill {
  background: linear-gradient(90deg, var(--neon-lime), #84cc16);
  transition: width 0.5s ease;
}
.progress-fill.full {
  background: linear-gradient(90deg, #ef4444, #dc2626);
}

/* ===== ì •ë³´ ë°•ìŠ¤ ===== */
.info-box {
  background: rgba(39, 39, 42, 0.5);
  border: 1px solid rgba(255,255,255,0.05);
}

/* ===== í¼ ì…ë ¥ ===== */
.form-input {
  background: rgba(24, 24, 27, 0.8);
  border: 1px solid rgba(255,255,255,0.1);
  transition: all 0.2s ease;
}
.form-input:focus {
  border-color: var(--neon-lime);
  outline: none;
  box-shadow: 0 0 0 3px rgba(196, 255, 0, 0.1);
}

/* ===== ì‹ ì²­ ë²„íŠ¼ ===== */
.btn-apply {
  background: var(--neon-lime);
  color: #000;
  box-shadow: 0 0 20px rgba(196, 255, 0, 0.3);
  transition: all 0.3s ease;
}
.btn-apply:hover {
  box-shadow: 0 0 30px rgba(196, 255, 0, 0.5);
  transform: translateY(-2px);
}
.btn-apply:disabled {
  background: #3f3f46;
  color: #71717a;
  box-shadow: none;
  cursor: not-allowed;
  transform: none;
}

/* ===== ì‹ ì²­ ì™„ë£Œ ë°•ìŠ¤ ===== */
.applied-box {
  background: linear-gradient(135deg, rgba(196, 255, 0, 0.1), rgba(132, 204, 22, 0.05));
  border: 1px solid rgba(196, 255, 0, 0.3);
}

/* ===== êµ¬ë… í•„ìš” ë°•ìŠ¤ ===== */
.subscribe-box {
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.05));
  border: 1px solid rgba(168, 85, 247, 0.3);
}
</style>
{% endblock %}

{% block content %}
{% set is_closed = item.is_ended() or item.status == 'closed' %}
{% set is_full = item.is_full() %}
{% set progress = (item.current_count() / item.max_participants * 100) if item.max_participants > 0 else 0 %}
{% set is_subscriber = session.get('subscriber') or session.get('is_trial') or session.get('admin') %}
{% set can_apply = not is_closed and not is_full and (not item.subscribers_only or is_subscriber) and not user_applied %}

<div class="max-w-4xl mx-auto">
  <!-- ë’¤ë¡œê°€ê¸° -->
  <a href="{{ url_for('groupbuy_list') }}" class="inline-flex items-center gap-2 text-zinc-400 hover:text-white mb-6 transition">
    <i class="fas fa-arrow-left"></i>
    <span>ë’¤ë¡œê°€ê¸°</span>
  </a>

  <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
    <!-- ì™¼ìª½: ìƒì„¸ ì •ë³´ -->
    <div class="lg:col-span-3 space-y-6">
      <!-- ë©”ì¸ ì´ë¯¸ì§€ -->
      <div class="detail-card rounded-2xl overflow-hidden">
        <div class="relative aspect-video bg-zinc-800/50">
          {% if item.image %}
          <img src="{{ item.image }}" alt="{{ item.title }}" class="w-full h-full object-cover">
          {% else %}
          <div class="w-full h-full flex items-center justify-center text-6xl bg-gradient-to-br from-zinc-800 to-zinc-900">
            {% if item.category == 'sponsorship' %}ğŸ{% else %}ğŸ›’{% endif %}
          </div>
          {% endif %}
          
          <!-- ë§ˆê° ì˜¤ë²„ë ˆì´ -->
          {% if is_closed %}
          <div class="absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center">
            <span class="text-3xl font-black text-zinc-400">ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤</span>
          </div>
          {% elif is_full %}
          <div class="absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center">
            <span class="text-3xl font-black text-red-400">ì¸ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤</span>
          </div>
          {% endif %}
        </div>
        
        <div class="p-6">
          <!-- ë°°ì§€ë“¤ -->
          <div class="flex flex-wrap gap-2 mb-4">
            <span class="px-3 py-1.5 rounded-full text-xs font-black {% if item.category == 'sponsorship' %}badge-sponsor{% else %}badge-groupbuy{% endif %}">
              {% if item.category == 'sponsorship' %}ğŸ í˜‘ì°¬{% else %}ğŸ›’ ê³µêµ¬{% endif %}
            </span>
            {% if item.subscribers_only %}
            <span class="badge-subscriber px-3 py-1.5 rounded-full text-xs font-bold">ğŸ‘‘ êµ¬ë…ì ì „ìš©</span>
            {% endif %}
            {% if is_closed or is_full %}
            <span class="badge-closed px-3 py-1.5 rounded-full text-xs font-bold">ë§ˆê°</span>
            {% endif %}
          </div>
          
          {% if item.brand %}
          <p class="text-zinc-500 text-sm font-bold mb-2 uppercase tracking-wider">{{ item.brand }}</p>
          {% endif %}
          
          <h1 class="text-2xl md:text-3xl font-black text-white mb-4">{{ item.title }}</h1>
          
          {% if item.description %}
          <div class="text-zinc-300 leading-relaxed whitespace-pre-line">{{ item.description }}</div>
          {% endif %}
        </div>
      </div>
      
      <!-- í˜œíƒ -->
      {% if item.benefit %}
      <div class="detail-card rounded-2xl p-6">
        <h3 class="text-lg font-black text-white mb-4 flex items-center gap-2">
          <span class="text-[#c4ff00]">ğŸ</span> í˜œíƒ
        </h3>
        <div class="text-zinc-300 leading-relaxed whitespace-pre-line">{{ item.benefit }}</div>
      </div>
      {% endif %}
      
      <!-- ì‹ ì²­ ì¡°ê±´ -->
      {% if item.requirements %}
      <div class="detail-card rounded-2xl p-6">
        <h3 class="text-lg font-black text-white mb-4 flex items-center gap-2">
          <span class="text-[#c4ff00]">ğŸ“‹</span> ì‹ ì²­ ì¡°ê±´
        </h3>
        <div class="text-zinc-300 leading-relaxed whitespace-pre-line">{{ item.requirements }}</div>
      </div>
      {% endif %}
    </div>
    
    <!-- ì˜¤ë¥¸ìª½: ì‹ ì²­ íŒ¨ë„ -->
    <div class="lg:col-span-2">
      <div class="detail-card rounded-2xl p-6 sticky top-24">
        <!-- ì‹ ì²­ í˜„í™© -->
        <div class="mb-6">
          <h3 class="text-sm font-bold text-zinc-400 mb-3">ì‹ ì²­ í˜„í™©</h3>
          
          {% if item.max_participants > 0 %}
          <div class="mb-2">
            <div class="flex justify-between text-sm mb-1">
              <span class="text-zinc-400">ì°¸ì—¬ ì¸ì›</span>
              <span class="{% if is_full %}text-red-400{% else %}text-[#c4ff00]{% endif %} font-bold">
                {{ item.current_count() }} / {{ item.max_participants }}ëª…
              </span>
            </div>
            <div class="progress-bar h-3 rounded-full">
              <div class="progress-fill h-full rounded-full {% if is_full %}full{% endif %}" style="width: {{ progress }}%"></div>
            </div>
          </div>
          {% else %}
          <div class="info-box rounded-xl p-4 text-center">
            <span class="text-2xl font-black text-white">{{ item.current_count() }}</span>
            <span class="text-zinc-400 text-sm ml-1">ëª… ì‹ ì²­</span>
          </div>
          {% endif %}
        </div>
        
        <!-- ê¸°ê°„ ì •ë³´ -->
        {% if item.end_date %}
        <div class="info-box rounded-xl p-4 mb-6">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center">
              <i class="fas fa-clock text-[#c4ff00]"></i>
            </div>
            <div>
              <p class="text-xs text-zinc-500">ë§ˆê°ì¼</p>
              <p class="text-white font-bold">{{ item.end_date.strftime('%Yë…„ %mì›” %dì¼ %H:%M') }}</p>
            </div>
          </div>
        </div>
        {% endif %}
        
        <!-- ì—°ë½ì²˜ -->
        {% if item.contact %}
        <div class="info-box rounded-xl p-4 mb-6">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center">
              <i class="fas fa-headset text-[#c4ff00]"></i>
            </div>
            <div>
              <p class="text-xs text-zinc-500">ë¬¸ì˜</p>
              <p class="text-white font-bold">{{ item.contact }}</p>
            </div>
          </div>
        </div>
        {% endif %}
        
        <!-- ì‹ ì²­ ìƒíƒœë³„ í‘œì‹œ -->
        {% if user_applied %}
        <!-- ì´ë¯¸ ì‹ ì²­í•¨ -->
        <div class="applied-box rounded-xl p-6 text-center">
          <div class="text-4xl mb-3">âœ…</div>
          <p class="text-[#c4ff00] font-bold text-lg">ì‹ ì²­ ì™„ë£Œ!</p>
          <p class="text-zinc-400 text-sm mt-2">ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ê²°ê³¼ëŠ” ë³„ë„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</p>
        </div>
        
        {% elif is_closed %}
        <!-- ë§ˆê°ë¨ -->
        <div class="info-box rounded-xl p-6 text-center">
          <div class="text-4xl mb-3">â°</div>
          <p class="text-zinc-400 font-bold">ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤</p>
        </div>
        
        {% elif is_full %}
        <!-- ì¸ì› ë§ˆê° -->
        <div class="info-box rounded-xl p-6 text-center">
          <div class="text-4xl mb-3">ğŸ‘¥</div>
          <p class="text-red-400 font-bold">ì¸ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤</p>
        </div>
        
        {% elif item.subscribers_only and not is_subscriber %}
        <!-- êµ¬ë…ì ì „ìš© (ë¹„êµ¬ë…ì) -->
        <div class="subscribe-box rounded-xl p-6 text-center">
          <div class="text-4xl mb-3">ğŸ‘‘</div>
          <p class="text-purple-400 font-bold text-lg mb-2">êµ¬ë…ì ì „ìš©</p>
          <p class="text-zinc-400 text-sm mb-4">ì´ ê³µêµ¬/í˜‘ì°¬ì€ êµ¬ë…ìë§Œ ì‹ ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <a href="{{ url_for('pricing') }}" class="block w-full bg-purple-500 hover:bg-purple-400 text-white font-bold py-3 rounded-xl transition">
            êµ¬ë…í•˜ê³  ì‹ ì²­í•˜ê¸°
          </a>
        </div>
        
        {% elif not session.get('user_id') %}
        <!-- ë¹„ë¡œê·¸ì¸ -->
        <div class="info-box rounded-xl p-6 text-center">
          <div class="text-4xl mb-3">ğŸ”</div>
          <p class="text-zinc-400 font-bold mb-4">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
          <a href="{{ url_for('login', next=request.path) }}" class="block w-full bg-[#c4ff00] hover:bg-white text-black font-bold py-3 rounded-xl transition">
            ë¡œê·¸ì¸í•˜ê¸°
          </a>
        </div>
        
        {% else %}
        <!-- ì‹ ì²­ í¼ -->
        <form method="POST" action="{{ url_for('groupbuy_apply', item_id=item.id) }}" class="space-y-4">
          <div>
            <label class="block text-sm font-bold text-zinc-400 mb-2">ì´ë¦„ *</label>
            <input type="text" name="name" required placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                   class="form-input w-full px-4 py-3 rounded-xl text-white">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-zinc-400 mb-2">ì—°ë½ì²˜ *</label>
            <input type="tel" name="phone" required placeholder="010-0000-0000"
                   class="form-input w-full px-4 py-3 rounded-xl text-white">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-zinc-400 mb-2">SNS ì±„ë„ URL</label>
            <input type="url" name="sns_url" placeholder="https://instagram.com/..."
                   class="form-input w-full px-4 py-3 rounded-xl text-white">
          </div>
          
          <div>
            <label class="block text-sm font-bold text-zinc-400 mb-2">ì‹ ì²­ ë©”ì‹œì§€</label>
            <textarea name="message" rows="3" placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œë‚˜ ì‹ ì²­ ì´ìœ ë¥¼ ì ì–´ì£¼ì„¸ìš”"
                      class="form-input w-full px-4 py-3 rounded-xl text-white resize-none"></textarea>
          </div>
          
          <button type="submit" class="btn-apply w-full py-4 rounded-xl font-black text-lg">
            ì‹ ì²­í•˜ê¸°
          </button>
          
          <p class="text-xs text-zinc-500 text-center">
            ì‹ ì²­ ì‹œ ê°œì¸ì •ë³´ ìˆ˜ì§‘ì— ë™ì˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
          </p>
        </form>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
